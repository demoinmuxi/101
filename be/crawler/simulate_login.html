<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模拟登陆 | 木犀 101</title>
    <meta name="description" content="木犀沉淀的互联网学习入门指南">
    
    
    <link rel="preload" href="/101/assets/css/0.styles.5cedd186.css" as="style"><link rel="preload" href="/101/assets/js/app.bb2ecb42.js" as="script"><link rel="preload" href="/101/assets/js/2.ea27f4c1.js" as="script"><link rel="preload" href="/101/assets/js/4.c66b59c2.js" as="script"><link rel="prefetch" href="/101/assets/js/10.effa6bd7.js"><link rel="prefetch" href="/101/assets/js/11.05145309.js"><link rel="prefetch" href="/101/assets/js/12.3538de65.js"><link rel="prefetch" href="/101/assets/js/13.9fb53bdf.js"><link rel="prefetch" href="/101/assets/js/14.a092c8b5.js"><link rel="prefetch" href="/101/assets/js/15.3043e8b9.js"><link rel="prefetch" href="/101/assets/js/16.923bb3ab.js"><link rel="prefetch" href="/101/assets/js/17.366123fd.js"><link rel="prefetch" href="/101/assets/js/18.9c65c48d.js"><link rel="prefetch" href="/101/assets/js/19.e97f9560.js"><link rel="prefetch" href="/101/assets/js/20.8aa1290e.js"><link rel="prefetch" href="/101/assets/js/21.5617ab5b.js"><link rel="prefetch" href="/101/assets/js/22.7d767ca5.js"><link rel="prefetch" href="/101/assets/js/23.56022bc6.js"><link rel="prefetch" href="/101/assets/js/24.ae4c07bd.js"><link rel="prefetch" href="/101/assets/js/25.b317dee3.js"><link rel="prefetch" href="/101/assets/js/26.74b164a3.js"><link rel="prefetch" href="/101/assets/js/27.ed28f1b1.js"><link rel="prefetch" href="/101/assets/js/28.397adef9.js"><link rel="prefetch" href="/101/assets/js/29.3af9dffe.js"><link rel="prefetch" href="/101/assets/js/3.3cc60c82.js"><link rel="prefetch" href="/101/assets/js/30.a1727c0b.js"><link rel="prefetch" href="/101/assets/js/31.e35e39f8.js"><link rel="prefetch" href="/101/assets/js/32.5b3be969.js"><link rel="prefetch" href="/101/assets/js/33.267d8659.js"><link rel="prefetch" href="/101/assets/js/34.e76c2a9e.js"><link rel="prefetch" href="/101/assets/js/35.ed193156.js"><link rel="prefetch" href="/101/assets/js/36.7321970e.js"><link rel="prefetch" href="/101/assets/js/37.0fd3028b.js"><link rel="prefetch" href="/101/assets/js/38.dd08a1fc.js"><link rel="prefetch" href="/101/assets/js/39.096843b3.js"><link rel="prefetch" href="/101/assets/js/40.2b143204.js"><link rel="prefetch" href="/101/assets/js/41.e196c4ff.js"><link rel="prefetch" href="/101/assets/js/42.6ce0bed0.js"><link rel="prefetch" href="/101/assets/js/43.6ad27a1b.js"><link rel="prefetch" href="/101/assets/js/44.4d1ff5f7.js"><link rel="prefetch" href="/101/assets/js/45.1f0d4e09.js"><link rel="prefetch" href="/101/assets/js/46.6bfc110e.js"><link rel="prefetch" href="/101/assets/js/47.afe8d06d.js"><link rel="prefetch" href="/101/assets/js/48.e2b9c6a6.js"><link rel="prefetch" href="/101/assets/js/49.98cab665.js"><link rel="prefetch" href="/101/assets/js/5.c2fecca7.js"><link rel="prefetch" href="/101/assets/js/50.98b333fa.js"><link rel="prefetch" href="/101/assets/js/51.92f718b3.js"><link rel="prefetch" href="/101/assets/js/52.de88f8bc.js"><link rel="prefetch" href="/101/assets/js/6.dda5d753.js"><link rel="prefetch" href="/101/assets/js/7.cd7d9593.js"><link rel="prefetch" href="/101/assets/js/8.b6d0235d.js"><link rel="prefetch" href="/101/assets/js/9.b2ac6cd7.js">
    <link rel="stylesheet" href="/101/assets/css/0.styles.5cedd186.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/101/" class="home-link router-link-active"><!----> <span class="site-name">木犀 101</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/101/fe/" class="nav-link">前端</a></div><div class="nav-item"><a href="/101/android/" class="nav-link">安卓</a></div><div class="nav-item"><a href="/101/be/" class="nav-link router-link-active">后端</a></div><div class="nav-item"><a href="/101/product/" class="nav-link">产品</a></div><div class="nav-item"><a href="/101/design/" class="nav-link">设计</a></div><div class="nav-item"><a href="/101/cs/" class="nav-link">计算机基础</a></div><div class="nav-item"><a href="/101/soft/" class="nav-link">软技能</a></div><div class="nav-item"><a href="/101/job/" class="nav-link">求职</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/101/fe/" class="nav-link">前端</a></div><div class="nav-item"><a href="/101/android/" class="nav-link">安卓</a></div><div class="nav-item"><a href="/101/be/" class="nav-link router-link-active">后端</a></div><div class="nav-item"><a href="/101/product/" class="nav-link">产品</a></div><div class="nav-item"><a href="/101/design/" class="nav-link">设计</a></div><div class="nav-item"><a href="/101/cs/" class="nav-link">计算机基础</a></div><div class="nav-item"><a href="/101/soft/" class="nav-link">软技能</a></div><div class="nav-item"><a href="/101/job/" class="nav-link">求职</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>后端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/101/be/" class="sidebar-link">后端组简介</a></li><li><a href="/101/be/freshmen_fall.html" class="sidebar-link">大一上学期</a></li><li><a href="/101/be/freshmen_spring.html" class="sidebar-link">大一下学期</a></li><li><a href="/101/be/sophomore_fall.html" class="sidebar-link">大二上学期</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="模拟登陆"><a href="#模拟登陆" aria-hidden="true" class="header-anchor">#</a> 模拟登陆</h1> <p>大部分的网页都是动态的，我们所需要的信息也需要登陆之后才能获得；比如学校教务处的成绩和课表，知乎用户个人的信息，这些都需要我们先进行登录，才能进行下一步的操作（爬虫）。现在来简单说下如何进行最简单也最基本的模拟登录。</p> <p>现在大多数网站都有反爬虫机制，验证的规则也五花八样，想找到一个能练手的网站实在不容易。好在<a href="https://www.douban.com/" target="_blank" rel="noopener noreferrer">豆瓣<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>算是比较宽容的，它只有在发送登录请求十分频繁的条件下，才会放滑块验证这个大招。所以我们现在便以豆瓣为例。</p> <h1 id="找到账户验证的url"><a href="#找到账户验证的url" aria-hidden="true" class="header-anchor">#</a> 找到账户验证的url</h1> <blockquote><p>如果已经登录了豆瓣的，要先退出登录</p></blockquote> <p>打开豆瓣，按下 F12 （Fn+F12），审查元素，在最上面的一栏选择网络（Network），可以按下 Ctrl+R 刷新一下，然后就可以看到下方的列表里有很多条目，这些都是该网页在获取数据时请求的痕迹。</p> <p><img src="/101/assets/img/browser_inspect1.15d08723.png" alt=""></p> <p>现在不要关闭开发者模式（审查元素界面），填入豆瓣账号和密码，点击登录，然后你会看到右边的界面重新进行了载入。</p> <p>选择 XHR，对请求记录的 log 进行过滤，列表就只剩几个条目了。一个个点进去查看，基本上看 request URL 就知道哪个是账户验证的 API 了，但也并非绝对，有一些做的比较垃圾的网站就不会尊崇这种基本的命名规范，比如学校的云课堂，感兴趣的可以去看下。当然，实际上我们关注的也不是 Request URL，这只是方便我们在列表中查找罢了，实际上我们关注的是 Form Data（表单数据），我们填入的账户密码会以表单的形式提交给服务器进行验证。所以若发现 Form Data 里包含有我们的账户信息，那就绝对是我们要找的目标了。</p> <p>我们要找的就是名为 basic 的这条记录，链接为 <code>https://accounts.douban.com/j/mobile/login/basic</code>，记住这个条目所展示的页面，许多数据我们都要用到。</p> <p><img src="/101/assets/img/browser_inspect3.c8fd9e88.png" alt=""></p> <h1 id="模拟登录请求"><a href="#模拟登录请求" aria-hidden="true" class="header-anchor">#</a> 模拟登录请求</h1> <p>找到了验证的 url 后，我们不应该马上动手写代码，而是应该用 postman 来进行模拟请求，确认是否可以成功通过验证。</p> <blockquote><p>postman请自行去<a href="https://www.getpostman.com/downloads/" target="_blank" rel="noopener noreferrer">官网下载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="分析请求数据"><a href="#分析请求数据" aria-hidden="true" class="header-anchor">#</a> 分析请求数据</h2> <p>要进行模拟请求，首先得要明白请求需要什么数据，以怎样的格式请求。这就需要我们进行分析了。</p> <p><img src="/101/assets/img/browser_inspect.a9e9d885.png" alt=""></p> <p>观察页面，看到它的 Request Method 是 POST，而 Request Headers 包含有如下七个字段（以自己浏览器中的信息为准）：</p> <p><img src="/101/assets/img/browser_inspect2.d7ee7867.png" alt=""></p> <p>现在来观察Form Data的数据，有5个字段，其中对我们比较重要的就是 name 和 password 了。另外还有一个 ck 比较重要，这个我们之后再说。</p> <div class="language-shell extra-class"><pre class="language-text"><code>ck:
name: xxxxxx
password: ********
remember: false
ticket:
</code></pre></div><p>现在知道了该填什么字段，那就可以进行模拟请求了。</p> <h2 id="模拟请求"><a href="#模拟请求" aria-hidden="true" class="header-anchor">#</a> 模拟请求</h2> <p>打开 postman，填入用以验证的 url，将 method 设为 post，填入 Request Headers 和 Form Data，然后就可以请求了。</p> <p><img src="https://raw.githubusercontent.com/Shadowmaple/myDocuments/master/images/muxi_work/postman_test1.png" alt=""></p> <p>填入 Form Data：</p> <p><img src="/101/assets/img/postman_test2.77bb3bcc.png" alt=""></p> <p>请求成功，postman 将 response 数据自动显示为 json 格式。</p> <p><img src="/101/assets/img/postman_test3.56bd2c84.png" alt=""></p> <h2 id="意外的失败"><a href="#意外的失败" aria-hidden="true" class="header-anchor">#</a> 意外的失败</h2> <p>可能你会发现照着这样做请求却失败了，或是第一次请求成功，第二次请求却失败了，这就要我们来更改一下ck字段的值。可以回到浏览器，在已经登录的界面中，打开审查元素，点击元素（Elements）那栏，Ctrl+F，填入 ck进行搜索，找到 <code>&lt;input type=&quot;hidden&quot; name=&quot;ck&quot; value=&quot;Qg5w&quot;&gt;</code> 这栏，其中 value 的值就是我们要的值，将 Qg5w 填入 postman 中的 ck 字段，这样 就可以重新请求了。</p> <h1 id="代码实现"><a href="#代码实现" aria-hidden="true" class="header-anchor">#</a> 代码实现</h1> <h2 id="基本实现"><a href="#基本实现" aria-hidden="true" class="header-anchor">#</a> 基本实现</h2> <p>既然模拟请求已经成功，那么就可以用代码实现了。</p> <p>要用到的包有：<code>net/http</code>，<code>net/url</code>，<code>io/ioutil</code></p> <blockquote><p>net/http <a href="https://godoc.org/net/http" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>net/url <a href="https://godoc.org/net/url" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>io/ioutil <a href="https://golang.org/pkg/io/ioutil/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 请求url</span>
requestUrl <span class="token operator">:=</span> <span class="token string">&quot;https://accounts.douban.com/j/mobile/login/basic&quot;</span>

<span class="token comment">// 加入表单数据</span>
data <span class="token operator">:=</span> url<span class="token punctuation">.</span>Values<span class="token punctuation">{</span><span class="token punctuation">}</span>
data<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xxxxx&quot;</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;****&quot;</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;remember&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;ck&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;ticket&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>

payload <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>添加 http 请求</p> <div class="language-go extra-class"><pre class="language-go"><code>req<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> requestUrl<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre></div><p>添加 Request Headers：</p> <div class="language-go extra-class"><pre class="language-go"><code>req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Accept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://accounts.douban.com&quot;</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Referer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://accounts.douban.com/passport/login_popup?login_source=anony&quot;</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Sec-Fetch-Mode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cors&quot;</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36&quot;</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;X-Requested-With&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;XMLHttpRequest&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>发起请求：</p> <div class="language-go extra-class"><pre class="language-go"><code>res<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span>DefaultClient<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token keyword">defer</span> res<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>解析请求body，这里要用到<code>io/ioutil</code>包</p> <div class="language-go extra-class"><pre class="language-go"><code>body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre></div><p>输出查看</p> <div class="language-go extra-class"><pre class="language-go"><code>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>运行结果：</p> <div class="language-markdown extra-class"><pre class="language-markdown"><code>{&quot;status&quot;:&quot;success&quot;,&quot;message&quot;:&quot;success&quot;,&quot;description&quot;:&quot;处理成功&quot;,&quot;payload&quot;:{&quot;account<span class="token italic"><span class="token punctuation">_</span><span class="token content">info&quot;:{&quot;name&quot;:&quot;愆不阙&quot;,&quot;weixin</span><span class="token punctuation">_</span></span>binded&quot;:true,......以下省略......}}}
</code></pre></div><h2 id="优化"><a href="#优化" aria-hidden="true" class="header-anchor">#</a> 优化</h2> <p>虽然实现了请求，但还有一个问题需要完善一下，那就是我们的账号和密码是写在代码中的，极不安全。我们可以通过交互模式让用户在终端输入。另外密码的输入应当是隐性的、保密的，这就用到了 <a href="https://github.com/howeyc/gopass" target="_blank" rel="noopener noreferrer"><code>gopass</code>库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。gopass 库的使用算是非常简单的了，自己看文档吧。</p> <blockquote><p>gopass <a href="https://godoc.org/github.com/howeyc/gopass" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>实现输入：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> name <span class="token builtin">string</span>
fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;输入账号：&quot;</span><span class="token punctuation">)</span>
<span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Scanln</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>name<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;输入密码：&quot;</span><span class="token punctuation">)</span>
password<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> gopass<span class="token punctuation">.</span><span class="token function">GetPasswdMasked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>这样就算是比较完善了</p> <blockquote><p><a href="https://github.com/Shadowmaple/go/blob/master/crawler/doubanLogin.go" target="_blank" rel="noopener noreferrer">完整代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/101/assets/js/app.bb2ecb42.js" defer></script><script src="/101/assets/js/2.ea27f4c1.js" defer></script><script src="/101/assets/js/4.c66b59c2.js" defer></script>
  </body>
</html>
